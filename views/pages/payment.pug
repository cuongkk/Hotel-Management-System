extends ../layouts/default.pug

block main
  - const formatCurrency = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount)
  
  main.main
    
    div(class="flex flex-col md:flex-row md:items-center justify-between gap-4")
        div
            h1(class="text-2xl font-bold text-gray-800") Xác nhận thanh toán
            p(class="text-sm text-gray-500 mt-1") 
                | Mã phiếu thuê: 
                span(class="font-mono font-bold text-blue-600") ##{bookingData.rentalSlipId}

        div(class="flex items-center gap-2 text-sm lg:mr-12")
            span(class="text-gray-400 font-medium") Chọn phòng
            i(class="fa-solid fa-chevron-right text-xs text-gray-300")
            span(class="text-blue-600 font-bold bg-blue-50 px-3 py-1 rounded-full border border-blue-100") Thanh toán
            i(class="fa-solid fa-chevron-right text-xs text-gray-300")
            span(class="text-gray-400 font-medium") Hoàn tất

    form(action=`/payment/${bookingData.roomId}` method="POST" class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start")
        input(type="hidden" name="totalPrice" value=bookingData.totalPrice)
        div(class="lg:col-span-2 space-y-6")
            
            div(class="bg-white p-6 rounded-xl shadow-sm border border-gray-100")
                h2(class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2")
                    i(class="fa-solid fa-user-pen text-blue-500")
                    | Thông tin người thanh toán
                
                div(class="space-y-4")
                    div
                        label(class="block text-xs font-bold text-gray-500 uppercase mb-1") Họ và tên
                        input(type="text" name="customerName" value=(bookingData.customers[0] || '') class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Nhập tên người thanh toán" required)
                    
                    div
                        label(class="block text-xs font-bold text-gray-500 uppercase mb-1") Ghi chú (Nếu có)
                        textarea(name="note" rows="3" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Ví dụ: Khách làm hỏng cốc, giảm giá voucher...")

            div(class="bg-white p-6 rounded-xl shadow-sm border border-gray-100")
                h2(class="text-sm font-bold text-gray-800 mb-3 flex items-center justify-between")
                    span Danh sách khách lưu trú
                    span(class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full") #{bookingData.customers.length} khách
                
                div(class="flex flex-wrap gap-2")
                    each guest in bookingData.customers
                        span(class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-medium border border-blue-100")
                            i(class="fa-solid fa-user")
                            | #{guest}

            div(class="bg-white p-6 rounded-xl shadow-sm border border-gray-100")
                h2(class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2")
                    i(class="fa-solid fa-wallet text-blue-500")
                    | Hình thức thanh toán
                
                div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
                    label(class="group relative flex items-center gap-3 p-4 rounded-lg border border-gray-200 cursor-pointer hover:border-blue-500 hover:bg-blue-50/30 transition-all")
                        input(type="radio" name="paymentMethod" value="CASH" class="peer h-4 w-4 text-blue-600 focus:ring-blue-500" checked)
                        div(class="flex items-center justify-center w-10 h-10 rounded-full bg-green-100 text-green-600")
                            i(class="fa-solid fa-money-bill-wave")
                        div
                            p(class="font-bold text-gray-700 text-sm") Tiền mặt

                    label(class="group relative flex items-center gap-3 p-4 rounded-lg border border-gray-200 cursor-pointer hover:border-blue-500 hover:bg-blue-50/30 transition-all")
                        input(type="radio" name="paymentMethod" value="BANKING" class="peer h-4 w-4 text-blue-600 focus:ring-blue-500")
                        div(class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 text-blue-600")
                            i(class="fa-solid fa-qrcode")
                        div
                            p(class="font-bold text-gray-700 text-sm") Chuyển khoản (QR)

        div(class="lg:col-span-1")
            div(class="bg-white rounded-xl shadow-lg border border-gray-100 sticky top-6")
                div(class="bg-gray-800 p-4 text-white")
                    p(class="text-xs text-gray-400 uppercase font-bold tracking-wider") Thanh toán cho
                    h3(class="text-xl font-bold")= bookingData.roomName

                div(class="p-6 space-y-4")
                    div(class="flex justify-between items-center text-sm")
                        div
                            p(class="text-gray-400 text-xs mb-1") Ngày nhận phòng
                            p(class="font-bold text-gray-700")= bookingData.checkIn
                        div(class="text-right")
                            p(class="text-gray-400 text-xs mb-1") Thời gian ở
                            p(class="font-bold text-blue-600") #{bookingData.stayDays} ngày

                    div(class="border-t border-dashed border-gray-200 my-4")

                    div(class="space-y-3 text-sm")
                        div(class="flex justify-between text-gray-600")
                            span Tiền phòng (#{formatCurrency(bookingData.pricePerNight)} x #{bookingData.stayDays})
                            - let totalRoomPrice = bookingData.pricePerNight * bookingData.stayDays
                            span(class="font-medium") #{formatCurrency(totalRoomPrice)}
                        
                        if bookingData.customers.length >= bookingData.extraGuestThreshold
                            div(class="flex justify-between text-orange-600")
                                span Phụ thu quá người (#{bookingData.surchargeRatio * 100}%)
                                - let surchargeAmount = totalRoomPrice * bookingData.surchargeRatio
                                span + #{formatCurrency(surchargeAmount)}
                        
                        if bookingData.surchargeCoeff > 1
                            div(class="flex justify-between text-purple-600")
                                span Hệ số khách nước ngoài (x#{bookingData.surchargeCoeff})
                                if bookingData.hasForeign
                                    span Áp dụng
                                else 
                                    span Không áp dụng

                    div(class="border-t border-gray-200 my-4 pt-4")

                    div(class="flex justify-between gap-4 items-end")
                        div
                            span(class="font-bold text-gray-800 block") Tổng thanh toán
                            span(class="text-xs text-gray-400") Đã bao gồm thuế & phí
                        span(class="text-3xl font-extrabold text-emerald-600") #{formatCurrency(bookingData.totalPrice)}
                    
                div(class="p-4 bg-gray-50 border-t border-gray-100")
                    button(type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-lg shadow-md hover:shadow-lg transition-all transform active:scale-[0.98] flex justify-center items-center gap-2")
                        span Xác nhận & Xuất hóa đơn
                        i(class="fa-solid fa-print")